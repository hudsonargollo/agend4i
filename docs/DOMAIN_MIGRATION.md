# Domain Migration Guide

## Overview

This guide covers the migration from `agendai.online` to `agendai.clubemkt.digital` and provides instructions for updating external integrations, bookmarks, and configurations.

## Migration Summary

**Old Domain**: `agendai.online`
**New Domain**: `agendai.clubemkt.digital`
**Migration Date**: December 2024
**Status**: Complete

### What Changed

- All tenant booking URLs now use `agendai.clubemkt.digital/{tenant-slug}`
- Admin interface URLs now use `agendai.clubemkt.digital/app`
- Environment-specific domains for staging: `staging.agendai.clubemkt.digital`
- Development environment continues to use `localhost:8080`

## For End Users

### Updating Bookmarks

If you have bookmarked any AgendaI pages, please update them:

**Old URLs:**
- `https://agendai.online/{your-business}`
- `https://agendai.online/app`

**New URLs:**
- `https://agendai.clubemkt.digital/{your-business}`
- `https://agendai.clubemkt.digital/app`

### Sharing Booking Links

All new booking links generated by the platform automatically use the new domain. 
Previously shared links with the old domain will need to be updated manually.

## For Developers

### Code Changes Required

The migration involved updating all hardcoded domain references to use a centralized
domain configuration service. Key changes include:

1. **Domain Configuration Service** (`src/lib/domain.ts`)
   - Environment-aware domain resolution
   - Centralized URL generation
   - Support for environment variable overrides

2. **Component Updates**
   - Onboarding flow displays new domain
   - Dashboard shows correct public URLs
   - All UI components use dynamic domain resolution

3. **Environment Configuration**
   - `VITE_APP_DOMAIN` environment variable support
   - Environment-specific domain defaults
   - Build-time domain injection

### Environment Variables

Configure domains for different environments:

```bash
# Development (default)
VITE_APP_DOMAIN=localhost:8080

# Staging
VITE_APP_DOMAIN=staging.agendai.clubemkt.digital

# Production (default)
VITE_APP_DOMAIN=agendai.clubemkt.digital
```
## For External Integrations

### Webhook URLs

If you have webhooks configured that point to the old domain, update them:

**Old Webhook URLs:**
```
https://agendai.online/api/webhooks/booking-created
https://agendai.online/api/webhooks/payment-completed
```

**New Webhook URLs:**
```
https://agendai.clubemkt.digital/api/webhooks/booking-created
https://agendai.clubemkt.digital/api/webhooks/payment-completed
```

### API Endpoints

Update any API calls to use the new domain:

**Old API Base:**
```
https://agendai.online/api/
```

**New API Base:**
```
https://agendai.clubemkt.digital/api/
```

### Third-Party Services

Update configurations in external services:

1. **Payment Processors**
   - Update return URLs and webhook endpoints
   - Verify domain whitelist includes new domain

2. **Analytics Services**
   - Update domain tracking configuration
   - Add new domain to allowed origins

3. **CDN and DNS Services**
   - Update CNAME records if applicable
   - Configure SSL certificates for new domain

4. **Social Media Integration**
   - Update callback URLs for social login
   - Update shared link previews

## Testing the Migration

### Verification Checklist

- [ ] Tenant booking pages load correctly with new domain
- [ ] Admin interface accessible at new domain
- [ ] All internal links use new domain
- [ ] External integrations receive correct webhook URLs
- [ ] Email notifications contain correct domain references
- [ ] Social sharing uses new domain

### Environment Testing

Test domain resolution in all environments:

```bash
# Test development
npm run dev
# Verify localhost:8080 is used

# Test staging build
npm run build -- --mode staging
# Verify staging.agendai.clubemkt.digital is used

# Test production build
npm run build
# Verify agendai.clubemkt.digital is used
```

## Rollback Plan

In case of issues, the domain configuration can be temporarily reverted:

1. **Emergency Rollback**
   ```bash
   # Set environment variable to old domain
   VITE_APP_DOMAIN=agendai.online npm run build
   ```

2. **Partial Rollback**
   - Update specific components to use old domain temporarily
   - Modify domain configuration service defaults

3. **DNS Rollback**
   - Revert DNS changes if domain-level issues occur
   - Ensure SSL certificates are valid for rollback domain

## Support and Troubleshooting

### Common Issues

1. **Broken Links**
   - Check that all hardcoded domain references have been updated
   - Verify environment variables are correctly set
   - Clear browser cache and cookies

2. **SSL Certificate Issues**
   - Ensure SSL certificates are configured for new domain
   - Verify certificate chain is complete

3. **CORS Errors**
   - Update CORS configuration to include new domain
   - Check API server domain whitelist

### Getting Help

If you encounter issues during the migration:

1. Check the [Environment Configuration Guide](ENVIRONMENT_CONFIGURATION.md)
2. Review browser console for domain-related errors
3. Verify environment variables are correctly configured
4. Contact the development team with specific error messages

## Migration Timeline

- **Phase 1**: Code updates and testing (Completed)
- **Phase 2**: Staging environment deployment (Completed)
- **Phase 3**: Production deployment (Completed)
- **Phase 4**: External integration updates (In Progress)
- **Phase 5**: Old domain deprecation (Planned)

## Post-Migration Tasks

### Immediate (0-7 days)
- [ ] Update all external webhook configurations
- [ ] Notify users about bookmark updates
- [ ] Update documentation and help articles
- [ ] Monitor error logs for domain-related issues

### Short-term (1-4 weeks)
- [ ] Update marketing materials with new domain
- [ ] Configure domain redirects from old to new domain
- [ ] Update SEO configurations and sitemaps
- [ ] Verify all third-party integrations are working

### Long-term (1-3 months)
- [ ] Monitor analytics for traffic patterns
- [ ] Plan deprecation of old domain support
- [ ] Update any remaining legacy references
- [ ] Document lessons learned for future migrations